<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Comic Shop | Smooth Circular Rotation</title>
    <style>
        :root {
            --primary: #121212;
            --accent: #ff4757;
            --banner-height: 320px; /* Adjust based on your image aspect ratio */
            --side-height: 250px;   /* 20% shorter than the middle (approx) */
            --transition-speed: 0.5s;
        }

        body { font-family: 'Inter', sans-serif; margin: 0; background: #fdfdfd; }

        /* --- Character Banner Construction --- */
        header { 
            background: white; 
            padding: 20px 0 0; 
            text-align: center;
            border-bottom: 2px solid #eee;
        }
        
        .character-banner {
            display: flex;
            justify-content: center;
            align-items: flex-start; /* Heads stay at the top */
            max-width: 900px;
            margin: 0 auto;
            height: var(--banner-height);
            overflow: hidden; /* This hides the bottom 10%+ */
            position: relative;
        }

        .char-container {
            position: relative;
            cursor: pointer;
            transition: all var(--transition-speed) ease-in-out;
            width: 250px;
            z-index: 1;
            /* Ensure heads start at the very top of the banner */
            height: var(--side-height); 
        }

        /* --- The 20% Higher Middle Logic --- */
        .char-container.pos-center {
            z-index: 10;
            height: var(--banner-height); /* Full height */
            margin: 0 -80px; /* 30-40% Overlap */
        }

        .char-img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            object-position: top; /* Keeps head at the top regardless of height */
            transition: opacity 0.3s ease-in-out, transform var(--transition-speed);
            filter: drop-shadow(0 5px 15px rgba(0,0,0,0.1));
        }

        /* Smoothing the image "pop" */
        .char-container.fade-out .char-img {
            opacity: 0;
            transform: scale(0.95);
        }

        .char-label {
            position: absolute;
            bottom: 20px;
            width: 100%;
            font-size: 0.7rem;
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 2px;
            color: rgba(0,0,0,0.2);
            pointer-events: none;
        }
        .pos-center .char-label { color: var(--primary); z-index: 11; }

        /* --- Tabs --- */
        .tabs { display: flex; justify-content: center; background: var(--primary); position: sticky; top: 0; z-index: 1000; }
        .tab-btn { flex: 1; padding: 20px; border: none; background: none; color: #555; cursor: pointer; font-weight: 700; transition: 0.3s; }
        .tab-btn.active { color: #fff; box-shadow: inset 0 -4px 0 var(--accent); }

        /* --- Content --- */
        main { max-width: 1100px; margin: 40px auto; padding: 0 20px; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 20px; }
        .card { background: #fff; border: 1px solid #eee; padding: 20px; border-radius: 8px; text-align: center; }
        .box { height: 200px; background: #f4f4f4; margin-bottom: 15px; }

        @media (max-width: 600px) {
            :root { --banner-height: 220px; --side-height: 180px; }
            .char-container { width: 160px; }
            .char-container.pos-center { margin: 0 -50px; }
        }
    </style>
</head>
<body>

<header>
    <div class="character-banner">
        <div class="char-container" onclick="switchTab(0)" id="char-0">
            <img src="characters/kha_straight.png" class="char-img" id="img-0">
            <span class="char-label">Outfits</span>
        </div>
        <div class="char-container" onclick="switchTab(1)" id="char-1">
            <img src="characters/saf_straight.png" class="char-img" id="img-1">
            <span class="char-label">Accessories</span>
        </div>
        <div class="char-container" onclick="switchTab(2)" id="char-2">
            <img src="characters/dav_straight.png" class="char-img" id="img-2">
            <span class="char-label">Silver</span>
        </div>
    </div>

    <nav class="tabs">
        <button class="tab-btn active" onclick="switchTab(0)" id="btn-0">OUTFITS</button>
        <button class="tab-btn" onclick="switchTab(1)" id="btn-1">ACCESSORIES</button>
        <button class="tab-btn" onclick="switchTab(2)" id="btn-2">SILVER</button>
    </nav>
</header>

<main id="shop-view"></main>

<script>
    const categories = [
        { name: "Outfits", prefix: "kha", items: ["Street Armor", "Ghost Shell", "Phase Boots"] },
        { name: "Accessories", prefix: "saf", items: ["Pulse Link", "Scout Mask", "Utility Rig"] },
        { name: "Silver", prefix: "dav", items: ["Sigil Ring", "Orbital Charm", "Heavy Link"] }
    ];

    let isTransitioning = false;

    function switchTab(activeIndex) {
        if (isTransitioning) return;
        isTransitioning = true;

        const leftIdx = (activeIndex + 2) % 3;
        const rightIdx = (activeIndex + 1) % 3;

        const posMap = { [activeIndex]: "pos-center", [leftIdx]: "pos-left", [rightIdx]: "pos-right" };
        const faceMap = { [activeIndex]: "straight", [leftIdx]: "left", [rightIdx]: "right" };

        categories.forEach((cat, i) => {
            const container = document.getElementById(`char-${i}`);
            const img = document.getElementById(`img-${i}`);
            const btn = document.getElementById(`btn-${i}`);

            // 1. Start Fade
            container.classList.add('fade-out');

            // 2. Mid-transition: Swap image and change positions
            setTimeout(() => {
                img.src = `characters/${cat.prefix}_${faceMap[i]}.png`;
                container.className = "char-container " + posMap[i];
                btn.classList.toggle('active', i === activeIndex);
                
                // Visual order for flexbox
                if (i === activeIndex) container.style.order = 2;
                else if (i === leftIdx) container.style.order = 1;
                else container.style.order = 3;

                // 3. End Fade
                setTimeout(() => {
                    container.classList.remove('fade-out');
                    isTransitioning = false;
                }, 50);
            }, 250); // Matches the start of the CSS transition
        });

        renderContent(activeIndex);
    }

    function renderContent(idx) {
        const view = document.getElementById('shop-view');
        const mainCat = categories[idx];
        let html = `<h2>${mainCat.name} Collection</h2><div class="grid">`;
        html += mainCat.items.map(item => `<div class="card"><div class="box"></div><b>${item}</b><br><small>$85.00</small></div>`).join('');
        html += `</div>`;
        view.innerHTML = html;
    }

    // Load initial
    switchTab(0);
</script>

</body>
</html>
